<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <t t-name="popup_dynamic_combo">
        <div class="modal-dialog">
            <div class="popup touch-scrollable scrollable-y" style="width: 65%; min-height: 800px">
                <div class="card">
                    <p class="title"><t t-esc=" widget.options.title || 'Alert' " /></p>
                    <div class="card-content">
                        <div class="table-responsive" style="overflow: hidden;overflow-y: auto;max-height: 470px;">
                            <table class="table table-striped-1">
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="table-responsive"  style="overflow: hidden;overflow-y: auto;max-height: 470px;">
                            <table class="table table-striped-2">
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <span class="card-issue"/>
                <div class="footer">
                    <div class="button cancel">
                        Cancel
                    </div>
                    <div class="button confirm">
                        Confirm
                    </div>
                </div>
            </div>
        </div>
    </t>

    <t t-name="dynamic_combo_items">
        <t t-foreach="products" t-as="product">
            <t t-call="dynamic_combo_item"/>
        </t>
    </t>

    <t t-name="dynamic_combo_items_not_found">
        <p class="body">Combo Items not found</p>
    </t>

    <t t-name="dynamic_categories_combo">
        <t t-foreach="pos_categories" t-as="category">
            <span class='popup_category_item category-simple-button js-category-switch' t-att-data-category-id="category.id" >
                <t t-esc="category.name"/>
            </span>
        </t>
    </t>

    <t t-name="dynamic_combo_item">
        <article class="product" t-att-data-product-id="product.id" tabindex="0" t-attf-aria-labelledby="article_product_#{product.id}">
            <span class="btn minus">
                <i class="fa fa-minus"/>
            </span>
            <span class="btn plus">
                <i class="fa fa-plus"/>
            </span>
            <div class="combo-item-product-img-big">
                <img class='combo-item-product_list_image' t-att-src='widget.get_product_image_url(product)'/>
            </div>
            <span class="combo-item-price-tag">
                <t t-esc="widget.format_currency(widget.format_currency(product.combo_price), 'Product Price')"/>
            </span>
            <div class="product-name combo_item_name">
                <t t-esc="product.display_name"/>
            </div>
            <div class="combo-item-cart_qty">
                <t t-if="product.quantity">
                    <t t-esc="product.quantity"/>
                </t>
                <t t-if="!product.quantity">
                    0
                </t>
            </div>
            <span class="price-combo-tag">
                <t t-esc="widget.format_currency(product.combo_price,'Product Price')"/>
            </span>
        </article>
    </t>

    <t t-name="button_dynamic_combo">
        <button class="control-button">
            <i class='fa fa-list' /> Dynamic Combo
        </button>
    </t>

    <t t-extend="Orderline">
        <t t-jquery="ul[class*='info-list']" t-operation="after">
            <t t-if="line.selected_combo_items">
                <t t-foreach="line.selected_combo_items" t-as="product_id">
                    <t t-set="product" t-value="widget.pos.db.get_product_by_id(product_id)"/>
                    <t t-if="product">
                        <ul class="info-list">
                            x
                            <t t-esc="line.selected_combo_items[product_id]"/>
                            <t t-esc="product.display_name"/>
                        </ul>
                    </t>
                </t>
            </t>
        </t>
    </t>

    <t t-extend="OrderReceipt">
        <t t-jquery="span[class*='price_display']" t-operation="after">
            <t t-if="line.selected_combo_items">
                <t t-foreach="line.selected_combo_items" t-as="product_id">
                    <t t-set="product" t-value="widget.pos.db.get_product_by_id(product_id)"/>
                    <t t-if="product">
                        <div class="receipt-line pos-receipt-left-padding">
                            x
                            <t t-esc="line.selected_combo_items[product_id]"/>
                            <t t-esc="product.display_name"/>
                        </div>
                    </t>
                </t>
            </t>
        </t>
    </t>

    <t t-extend="Product">
        <t t-jquery="div[class*='product-name']" t-operation="after">
            <t t-if="product.is_combo and widget.pos.config.dynamic_combo">
                <div class="ribbon">
                    <span>
                        Combo: <t t-esc="widget.format_currency(product.combo_total_price)"/>
                    </span>
                </div>
            </t>
        </t>
    </t>

    <t t-extend="OrderChangeReceipt">
        <t t-jquery="t[t-foreach*='changes.cancelled']" t-operation="replace">
            <t t-foreach="changes.cancelled" t-as="change">
                <div>
                    <t t-esc="change.qty"/>
                    <span t-esc="change.name_wrapped[0]" class="pos-receipt-right-align"/>
                </div>
                <t t-call="NameWrapped"/>
                <t t-if="change.note">
                    <div>
                        NOTE
                        <span class="pos-receipt-right-align">...</span>
                    </div>
                    <div><span class="pos-receipt-left-padding">--- <t t-esc="change.note" /></span></div>
                    <br/>
                </t>
                <t t-if="change.selected_combo_items">
                    <t t-foreach="change.selected_combo_items" t-as="product_id">
                        <t t-set="product" t-value="widget.pos.db.get_product_by_id(product_id)"/>
                        <t t-if="product">
                            <div style="text-align: left">
                                <span font='c' line-ratio='0.4' indent='1'>
                                    + <t t-esc="change.selected_combo_items[product_id]"/> <t t-esc="product.display_name"/>
                                </span>
                            </div>
                        </t>
                    </t>
                </t>
            </t>
        </t>
        <t t-jquery="t[t-foreach*='changes.new']" t-operation="replace">
            <t t-foreach="changes.new" t-as="change">
                <div>
                    <t t-esc="change.qty"/>
                    <span t-esc="change.name_wrapped[0]" class="pos-receipt-right-align"/>
                </div>
                <t t-call="NameWrapped"/>
                <t t-if="change.note">
                    <div>
                        NOTE
                        <span class="pos-receipt-right-align">...</span>
                    </div>
                    <div><span class="pos-receipt-left-padding">--- <t t-esc="change.note" /></span></div>
                    <br/>
                </t>
                <t t-if="change.selected_combo_items">
                    <t t-foreach="change.selected_combo_items" t-as="product_id">
                        <t t-set="product" t-value="widget.pos.db.get_product_by_id(product_id)"/>
                        <t t-if="product">
                            <div style="text-align: left">
                                <span font='c' line-ratio='0.4' indent='1'>
                                    + <t t-esc="change.selected_combo_items[product_id]"/> <t t-esc="product.display_name"/>
                                </span>
                            </div>
                        </t>
                    </t>
                </t>
            </t>
        </t>
    </t>

</templates>